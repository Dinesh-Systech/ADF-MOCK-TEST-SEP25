{
	"name": "DF_Acc_fullload",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DS_BLOB_IN1677",
						"type": "DatasetReference"
					},
					"name": "SrcAcc"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "DS_BLOB_IN1677",
						"type": "DatasetReference"
					},
					"name": "SnkstgDimAccountmodIN1677"
				}
			],
			"transformations": [
				{
					"name": "Transformation"
				},
				{
					"name": "SurAccountkey"
				},
				{
					"name": "NullHandling"
				}
			],
			"scriptLines": [
				"source(output(",
				"          AccountID as integer,",
				"          CustomerID as integer,",
				"          AccountNumber as integer,",
				"          AccountType as string,",
				"          OpenDate as date,",
				"          CloseDate as date,",
				"          Status as string,",
				"          BranchCode as string,",
				"          Currency as string,",
				"          InterestRate as double,",
				"          CreditLimit as double,",
				"          Balance as double,",
				"          OverdraftLimit as double,",
				"          IsJointAccount as integer,",
				"          Channel as string,",
				"          LastActivityDate as date,",
				"          {created_by } as string,",
				"          created_date as timestamp,",
				"          updated_date as timestamp,",
				"          updated_by as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> SrcAcc",
				"SrcAcc derive(SharedLiabilityRisk = \r",
				"iif(IsJointAccount==1 && OverdraftLimit>10000, 'Shared Liability Risk', iif(IsJointAccount==1&&OverdraftLimit<=10000, 'Joint Account - Normal Risk', \r",
				"iif(IsJointAccount == 0 && OverdraftLimit > 10000, 'Single Account - High Exposure',  'Low Risk'))),",
				"          DaysSinceLastActivity = monthsBetween(LastActivityDate,currentDate())*30) ~> Transformation",
				"Transformation keyGenerate(output(account_key as long),",
				"     startAt: 1L,",
				"     stepValue: 1L) ~> SurAccountkey",
				"SurAccountkey derive(each(match(type=='string'), $$ = iif(isNull($$)||lower($$)=='null', 'unk', $$)),",
				"          each(match(type=='integer'), $$ = iifNull($$, 0, $$)),",
				"          each(match(type=='timestamp'), $$ = iifNull($$, toDate('1990-01-01 00:00:00'), $$))) ~> NullHandling",
				"NullHandling sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     partitionFileNames:['Dim_account_mod_IN1677'],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     partitionBy('hash', 1)) ~> SnkstgDimAccountmodIN1677"
			]
		}
	}
}